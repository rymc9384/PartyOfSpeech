load("cong_text/rdata/topic_modeling/processed_text/Processed/ExpAgenda_TextDF_114.RData")
cat(textsDF$title[12])
textsDF$title[c(12, 94, 126, 227, 240, 300)]
textsDF$topic_text[c(12, 94, 126, 227, 240, 300)]
textsDF$topic_text[c(13, 67, 73, 117, 124, 137)]
x <- c(13, 67, 73, 117, 124, 137)
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 58, 69, 75, 83, 183, 243 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 12, 94, 126, 227, 240, 300 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 374, 1118, 1133, 1144, 1150, 1161 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 13, 67, 73, 117, 124, 137 )
textsDF$title[x]
textsDF$topic_text[x]
textsDF$form_date[x]
x <- c( 83, 550, 674, 2121, 2559, 2660 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 8, 14, 37, 49, 91, 93 )
textsDF$title[x]
x <- c( 535, 754, 1023, 1428, 1715, 1943 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 211, 421, 804, 1310, 1344, 1350 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 27, 59, 95, 159, 160, 164 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 25, 151, 161, 192, 305, 433 )
textsDF$title[x]
x <- c( 588, 2831, 3344, 3480, 3520, 3541 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 710, 1328, 1449, 2091, 2205, 2751 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 188, 826, 1356, 1498, 1499, 1748 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 29, 32, 593, 595, 606, 732 )
textsDF$title[x]
x <- c( 550, 674, 2121, 2559, 2784, 2890 )
textsDF$title[x]
load("D:/cong_text/rdata/topic_modeling/model_fits/Fits/114/modelfit_34_114.RData")
plot(density(expAgenda$rs[,1]))
length(unique(expAgenda$rs[,1]))
summary(expAgenda$rs[,1])
z <- which(expAgenda$rs[,1] > 0.9)
z
out <- paste(high_probs, collapse = ", ")
rm(expAgenda)
rm(x)
rm(z)
x <- c( 40791, 18787, 16046, 15015, 46023 )
textsDF$title[x]
textsDF$topic_text[x]
textsDF$title[x]
x <- c( 40578, 3742, 12158, 11597, 8805 )
textsDF$title[x]
x <- c( 31882, 32174, 40722, 44379, 40334 )
textsDF$title[x]
x <- c( 5898, 34117, 44312, 1103, 31945 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 9391, 24483, 2666, 16117, 15710 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 17626, 35202, 15942, 10047, 12577 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 38575, 28558, 26740, 515, 11774 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 19279, 45280, 32717, 19057, 42976 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 24709, 31349, 21475, 32113, 38723 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 652, 3653, 16116, 24918, 49625 )
textsDF$title[x]
x <- c( 23253, 21010, 6172, 41379, 18306 )
textsDF$title[x]
x <- c( 24709, 31349, 21475, 32113, 38723 )
textsDF$title[x]
x <- c( 24192, 28046, 12, 21991, 20407 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 48315, 750, 22081, 15532, 6700 )
textsDF$title[x]
x <- c( 1998, 43944, 21703, 23207, 31772 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 19675, 11287, 32105, 837, 17679 )
textsDF$title[x]
x <- c( 8833, 12008, 12569, 6084, 3493 )
textsDF$title[x]
x <- c( 34719, 40125, 1850, 16059, 13128 )
textsDF$title[x]
x <- c( 30589, 14114, 27115, 11556, 2191 )
textsDF$title[x]
textsDF$docnum[x]
x <- c( 41472, 20738, 15291, 40834, 41254 )
textsDF$title[x]
x <- c( 16051, 2776, 2981, 32346, 18123 )
textsDF$title[x]
x <- c( 16883, 1949, 36881, 37164, 16082 )
textsDF$title[x]
x <- c( 35370, 10692, 1564, 8547, 34700 )
textsDF$title[x]
x <- c( 17023, 26036, 27049, 27084, 37192 )
textsDF$title[x]
load("D:/cong_text/rdata/topic_modeling/model_fits/Fits/114/modelfit_34_114.RData")
sum(expAgenda$rs[1,])
expAgenda$rs[1,]
max(expAgenda$rs[1,])
textsDF[1,]
summary(apply(expAgenda$rs, 1, max))
x <- c( 17023, 26036, 27049, 27082, 37255 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 4763, 43362, 35510, 41460, 28901 )
textsDF$title[x]
x <- c( 16077, 2814, 2981, 32357, 18123 )
textsDF$title[x]
x <- c( 29868, 28496, 10678, 7770, 37458 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 21222, 6138, 25201, 2924, 48493 )
textsDF$title[x]
x <- c( 5503, 42161, 45364, 20449, 18934 )
textsDF$title[x]
x <- c( 1185, 22421, 9608, 4179, 23094 )
textsDF$title[x]
x <- c( 23992, 3340, 19416, 46894, 48650 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 24410, 49728, 44735, 5301, 25768 )
textsDF$title[x]
x <- c( 23798, 38120, 6292, 1788, 12824 )
textsDF$title[x]
x <- c( 6437, 35388, 33319, 5904, 14306 )
textsDF$title[x]
x <- c( 45743, 46018, 14774, 40249, 7878 )
textsDF$title[x]
x <- c(  667, 9140, 42647, 887, 46006 )
textsDF$title[x]
textsDF$topic_text[x]
x <- c( 23055, 12678, 22560, 22773, 33300 )
textsDF$title[x]
x <- c(  10685, 45217, 33104, 39826, 32451 )
textsDF$title[x]
x <- c( 31036, 13633, 11316, 26482, 47697 )
textsDF$title[x]
x <- c( 34591, 42084, 38630, 25157, 30251 )
textsDF$title[x]
load("D:/cong_text/rdata/topic_modeling/processed_text/Processed/ExpAgenda_TextDF_114.RData")
write.csv(x = textsDF, file = "D:/cong_text/csvs/tokenized/topicmodeling/ExpAgendas/Processed/ExpAgenda_TextDF_114.csv", fileEncoding = 'utf-8')
write.csv(x = textsDF, file = "D:/cong_text/csvs/tokenized/topicmodeling/ExpAgendas/Processed/ExpAgenda_TextDF_114.csv", fileEncoding = 'utf-8', row.names = F)
load("D:/cong_text/rdata/topic_modeling/processed_text/Processed/ExpAgenda_TextDF_113.RData")
write.csv(x = textsDF, file = "D:/cong_text/csvs/tokenized/topicmodeling/ExpAgendas/Processed/ExpAgenda_TextDF_113.csv", fileEncoding = 'utf-8', row.names = F)
rm(list=ls())
df <- read.csv("D:\cong_text\csvs\tokenized\topicmodeling\ExpAgendas")
df <- read.csv("D:/cong_text/csvs/tokenized/topicmodeling/ExpAgendas/topictext_114Cong.csv")
rm(list=ls())
options(stringsAsFactors = F)
tdf <- read.csv("D:/cong_text/csvs/tokenized/topicmodeling/ExpAgendas/topictext_114Cong.csv")
tops <- read.csv("D:/Dropbox/Dissertation/02-pos_senate/01-code/03-topic_modeling/ExpAgenda/topic_labeling/topic_labeling_114.csv")
tdf$topic_text[tdf$docid %in% tops$docs[1]]
x <- strsplit(x = tops$docs, split = ",")
tdf$topic_text[tdf$docid %in% x[1]]
tdf$topic_text[tdf$docid %in% x[[1]]]
x[[1]]
tdf$docid %in% x[[1]]
sum(tdf$docid %in% x[[1]])
x <- strsplit(x = tops$docs, split = ", ")
tdf$topic_text[tdf$docid %in% x[[1]]]
tdf$topic_text[tdf$docid %in% x[[2]]]
x[[2]]
tdf$topic_text[tdf$docid %in% x[[3]]]
tdf$topic_text[tdf$docid %in% x[[4]]]
tdf$topic_text[tdf$docid %in% x[[5]]]
tdf$topic_text[tdf$docid %in% x[[6]]]
tdf$topic_text[tdf$docid %in% x[[7]]]
x[[7]]
tdf$topic_text[tdf$docid %in% x[[9]]]
tdf$topic_text[tdf$docid %in% x[[10]]]
tdf$topic_text[tdf$docid %in% x[[13]]]
tdf$topic_text[tdf$docid %in% x[[14]]]
tdf$topic_text[tdf$docid %in% x[[16]]]
load("cong_text/rdata/topic_modeling/rep_fits/Replications/114/repfit_49_43_114.RData")
w_max <- function(x){
which(x == max(x))
}
tops <- apply(expAgenda$rs, 1, w_max)
tops[1:10]
which(tops == 20)
tdf$topic_text[sample(x = which(tops == 20), size = 10)]
tdf$topic_text[sample(x = which(tops == 20), size = 10)]
tdf$topic_text[sample(x = which(tops == 21), size = 10)]
tdf$topic_text[sample(x = which(tops == 22), size = 10)]
tdf$topic_text[sample(x = which(tops == 22), size = 10)]
tdf$topic_text[sample(x = which(tops == 22), size = 10)]
tdf$topic_text[sample(x = which(tops == 22), size = 10)]
tdf$topic_text[sample(x = which(tops == 21), size = 10)]
tdf$topic_text[tdf$docid %in% x[[22]]]
tdf$topic_text[tdf$docid %in% x[[23]]]
tdf$topic_text[tdf$docid %in% x[[21]]]
tdf$topic_text[tdf$docid %in% x[[26]]]
tdf$topic_text[sample(x = which(tops == 26), size = 10)]
tdf$topic_text[sample(x = which(tops == 26), size = 10)]
tdf$topic_text[sample(x = which(tops == 27), size = 10)]
tdf$topic_text[sample(x = which(tops == 27), size = 10)]
tdf$topic_text[sample(x = which(tops == 28), size = 10)]
tdf$topic_text[sample(x = which(tops == 31), size = 10)]
tdf$topic_text[sample(x = which(tops == 32), size = 10)]
tdf$topic_text[sample(x = which(tops == 33), size = 10)]
tdf$topic_text[sample(x = which(tops == 40), size = 10)]
tdf$topic_text[tdf$docid %in% x[[40]]]
rm(list=ls())
library(tm)
library(optparse)
options(stringsAsFactors = F)
## Parse command line arguments:
option_list <- list(
make_option(c("-i", "--infile"), type="character", default="D:/cong_text/csvs/tokenized/topicmodeling/ExpAgendas/topictext_114Cong.csv",
help="Tokenized and processed text infile path [default=%default]", metavar="character"),
make_option(c("-op", "--outpath"), type="character", default="./Processed/",
help="output directory [default= %default]", metavar="character"),
make_option(c("-to", "--textoutfile"), type="character", default="ExpAgenda_TextDF_114.RData",
help="textoutput file name [default= %default]", metavar="character"),
make_option(c("-po", "--processedoutfile"), type="character", default="ExpAgenda_Processed_114.RData",
help="processed output file name [default= %default]", metavar="character")
)
opt_parser <- OptionParser(option_list=option_list)
opt <- parse_args(opt_parser)
## Set working directory and executing modified processing script:
setwd("D:/Dropbox/Dissertation/02-pos_senate/01-code/03-topic_modeling/ExpAgenda")
source(file = "./ExpAgenda-master/R/PreProcess.R")
## Read in tokenized text data:
textsDF <- read.csv(file = opt$infile)
## Get rid of documents that are less than 25 tokens long:
# Get document lengths
textlens <- NA
for (i in 1:length(textsDF$topic_text)){
temptext <- textsDF$topic_text[i]
temptext <- unlist(strsplit(x = temptext, split = " "))
textlens[i] <- length(temptext)
}
# Filter by doc length:
textsDF <- textsDF[which(textlens >= 25), ]
textsDF$form_date <- as.Date(textsDF$form_date, "%Y-%m-%d")
unique(textsDF$senator[textsDF$form_date < "2015-01-03"])
set.seed(11769)
seeds <- sample(x = 1:100000, size = opt$nreps, replace = F)
seeds <- sample(x = 1:100000, size = 100, replace = F)
getwd()
rm(list = ls())
library(optparse)
options(stringsAsFactors = FALSE)
set.seed(11769)
## Parse command line arguments:
option_list <- list(
make_option(c("-b", "--bounds"), type="character", default="./num_topics/lower_bounds_114.RData",
help="lower bounds rdata file [default= %default]", metavar="character"),
make_option(c("--labeled"), type="character", default="./topic_labeling/labeled_topics_114.csv",
help="path to textsDF w/ topic numbers will be stored [default= %default]", metavar="character"),
make_option(c("--outfile"), type="character", default="./topic_labeling/topic_summary_table_114.csv",
help="filename for output summary table [default= %default]", metavar="character")
)
opt_parser <- OptionParser(option_list=option_list)
opt <- parse_args(opt_parser)
#############################################
### 0) SET UP ENVIRONMENT
#############################################
message("Setting up the environment...")
## Load lower-bounds data (run_summary):
load(opt$bounds)
message("Defining functions...")
## 1.a) Index of Maximum:
w_max <- function( x ){
##################
## ARGS:
# 1) x (vector) = vector of sortable values
#
##################
return( which(x == max(x)) )
}
## 1.b) Get topic assignments:
max_topic <- function( topics ){
##################
## ARGS:
# 1) topics (matrix, D x K) = matrix of topic probabilities
#
#
##################
max_t <- apply(X = topics, MARGIN = 1, FUN = w_max)
return(max_t)
}
message("Selecting best run and loading fit...")
## 2.a) Which run has max lower-bound:
best.run <- w_max(run_summary$lower.bound)
message(paste0("Best run: ", run_summary$file[best.run], "..."))
message(paste0("Best run: ", run_summary$file[best.run]))
load(run_summary$file[best.run])
labeled <- read.csv(opt$labeled)
max.topic <- max_topic(topics = expAgenda$rs)
max_index <- function( x ){
##################
## ARGS:
# 1) x (matrix, n x K) = matrix of topic probabilities; n = D or |V|
#
#
##################
max_t <- apply(X = x, MARGIN = 1, FUN = w_max)
return(max_t)
}
max.topic <- max_index(x = expAgenda$rs)
topic.props <- prop.table(table(max.topic))
topic.props <- round( prop.table( table(max.topic) ), 4 ) * 100
topic.props
max.stem <- max_index(x = expAgenda$mus)
stem.props <- round( prop.table( table(max.stem) ), 4 ) * 100
stem.props
summary(expAgenda$mus[1,])
v.mus <- apply(expAgenda$mus, 1, var)
summary(v.mus)
v.mus <- apply(expAgenda$mus, 1, sd)
summary(v.mus)
p.topics <- NA
for (i in seq_along(max.topic)){
p.topics[i] <- expAgenda$rs[i, max.topic[i]]
}
summary(p.topics)
hist(p.topics)
quantile(p.topics, c(0.01, 0.25, 0.99, 0.999))
unique(p.topics)
sum(p.topics >= 0.99)
sum(p.topics >= 0.99) / length(p.topics)
sum(p.topics >= 0.95) / length(p.topics)
sum(p.topics >= 0.90) / length(p.topics)
sum(p.topics >= 0.50) / length(p.topics)
sum(p.topics >= 0.25) / length(p.topics)
sum(p.topics >= 0.20) / length(p.topics)
sum(p.topics <= 0.75) / length(p.topics)
sum(p.topics <= 0.5) / length(p.topics)
sum(p.topics <= 0.3) / length(p.topics)
sum(p.topics <= 0.75)
sum(p.topics <= 0.5)
sum(p.topics <= 0.9)
223/48528
summary(p.topics, probs=c(0.01, 0.1, 0.25))
?summary
quantile(p.topics, c(0.025, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.975, 0.999))
message(quantile(p.topics, c(0.025, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.975, 0.999)))
paste(quantile(p.topics, c(0.025, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.975, 0.999))
)
paste(quantile(p.topics, c(0.025, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.975, 0.999)), collapse = ", ")
message("0.025, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.975, 0.999")
message("# Quantiles\n0.025, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.975, 0.999")
paste(quantile(p.topics, c(0.025, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.975, 0.999)), collapse = ", ")
q.topics <- round(quantile(p.topics, c(0.025, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.975, 0.999)), 3)
q.topics <- round(quantile(p.topics, c(0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.975, 0.999)), 3)
q.topics <- round(quantile(p.topics, c(0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.975, 0.999)), 3)
message("x", "b")
message("# Quantiles\n0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.975, 0.999")
message("\t", paste(q.topics, collapse=" "))
message(paste(q.topics, collapse=" "))
message("# Quantiles\n0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.975, 0.999")
message(paste(q.topics, collapse=" "))
outtable <- labeled[,c("topic", "label", "stems", "notes")]
View(outtable)
for (i in seq_along(outtable$stems)){
print(i)
}
tmp_stems <- unlist(strsplit(outtable$stems[i], ", "))
tmp_stems
tmp_stems <- paste(tmp_stems[:5], collapse=", ")
tmp_stems <- paste(tmp_stems[1:5], collapse=", ")
## 5.a) Trim down labeled topics table:
outtable <- labeled[,c("topic", "label", "stems", "notes")]
# take only top 5 stems
for (i in seq_along(outtable$stems)){
tmp_stems <- unlist(strsplit(outtable$stems[i], ", "))
tmp_stems <- paste(tmp_stems[1:5], collapse=", ")
outtable$stems[i] <- tmp_stems
}
View(outtable)
View(outtable)
props.TopStem <- NA
for (i in seq_along(topic.props)){
props.TopStem[i] <- paste(topic.props[i], stem.props[i], collapse="/")
}
props.TopStem[i] <- paste(topic.props[i], stem.props[i], collapse="//")
paste(topic.props[i], stem.props[i], collapse="//")
stem.props
paste(topic.props[i], stem.props[i], collapse="\/")
paste(topic.props[i], stem.props[i], collapse=" ")
stem.props[i]
stem.props <- round( prop.table( table(max.stem) ) * 100, 4 )
topic.props <- round( prop.table( table(max.topic) ) * 100, 4 )
topic.props <- round( prop.table( table(max.topic) ) * 100, 2 )
stem.props <- round( prop.table( table(max.stem) ) * 100, 2 )
paste(topic.props[i], stem.props[i], collapse=" ")
as.character(stem.props[i])
stem.props[i]
topic.props <- round( as.numeric( prop.table( table(max.topic) ) * 100 ), 2 )
stem.props <- round( as.numeric( prop.table( table(max.stem) ) * 100 ), 2 )
stem.props[i]
round(stem.props[i])
round(stem.props[i], 2)
max.topic <- max_index(x = expAgenda$rs)
topic.props <- round( prop.table( table(max.topic) ) * 100, 2 )
## 4.b) Stem proportions:
max.stem <- max_index(x = expAgenda$mus)
stem.props <- round( prop.table( table(max.stem) ) * 100, 2 )
paste(topic.props, stem.props, collapse = " ")
paste(topic.props[:], stem.props[:], collapse = " ")
paste(topic.props[i]), stem.props[i], collapse=" / ")
paste(topic.props[i], stem.props[i], collapse=" / ")
paste(topic.props[i], stem.props[i], collapse=" //// ")
paste(topic.props[i], stem.props[i], collapse=" /// ")
paste(topic.props[i], stem.props[i], collapse=" [/] ")
paste(topic.props[i], stem.props[i], collapse=" ")
paste0(topic.props[i], "/", stem.props[i])
paste0(topic.props[i], " / ", stem.props[i])
outtable$proportions <- NA
for (i in seq_along(topic.props)){
outtable$proportions[i] <- paste0(topic.props[i], " / ", stem.props[i])
}
View(outtable)
message("\n\nGenerating table with descriptives...")
## Parse command line arguments:
option_list <- list(
make_option(c("-b", "--bounds"), type="character", default="./num_topics/lower_bounds_114.RData",
help="lower bounds rdata file [default= %default]", metavar="character"),
make_option(c("--labeled"), type="character", default="./topic_labeling/labeled_topics_114.csv",
help="path to textsDF w/ topic numbers will be stored [default= %default]", metavar="character"),
make_option(c("--outmodel"), type="character", default="D:/cong_text/rdata/topic_modeling/best_run_114.RData",
help="filename and path for best run model data [default= %default]", metavar="character"),
make_option(c("--outtable"), type="character", default="./topic_labeling/topic_summary_table_114.csv",
help="filename and path for output summary table [default= %default]", metavar="character")
)
opt_parser <- OptionParser(option_list=option_list)
opt <- parse_args(opt_parser)
rm(list = ls())
library(optparse)
options(stringsAsFactors = FALSE)
## Parse command line arguments:
option_list <- list(
make_option(c("--reppath"), type="character", default="D:/cong_text/rdata/topic_modeling/rep_fits/Replications/113/",
help="path to replication runs [default= %default]", metavar="character"),
make_option(c("-p", "--processed"), type="character", default="./Processed/ExpAgenda_Processed_113.RData",
help="processed text rdata file [default= %default]", metavar="character"),
make_option(c("--outpath"), type="character", default="./num_topics/",
help="path to where lower-bounds will be stored [default= %default]", metavar="character"),
make_option(c("--outfile"), type="character", default="lower_bounds_114.RData",
help="output file name [default= %default]", metavar="character")
opt_parser <- OptionParser(option_list=option_list)
opt <- parse_args(opt_parser)
load(opt$processed)
ys <- processed$term.doc
rm(processed)
## 0.c) Get file names for  the replication runs:
infiles <- list.files(path = opt$reppath, pattern = "*.RData", full.names = T)
infiles[9]
load(infiles[9])
runs <- list()
reps <- gsub( pattern = ".*_(?=[0-9]{1,3}_45)", replacement = "", x = infiles, perl=T )
reps <- as.integer( gsub("_45.*$", "", reps) )
infiles <- infiles[order(reps)]
infiles[9]
load(infiles[9])
load("D:/cong_text/rdata/topic_modeling/rep_fits/Replications/113/repfit_9_45_113.RData")
load("D:/cong_text/rdata/topic_modeling/rep_fits/Replications/113/repfit_9_45_113.RData")
